{
  "id": "2025-11-04-mdns-selfcheck-test-10-type-missing-logging",
  "date": "2025-11-04",
  "component": "tests/bats/mdns_selfcheck.bats:460",
  "rootCause": "Test expected 'event=mdns_type_check' in stderr when service type is missing (not in enumeration and no instances found via active query). The script logged type check events when type_present=1 using log_debug with event name 'mdns_selfcheck', but when type_present=0 it used log_info with event name 'mdns_type_check'. This caused inconsistency: debug messages go to stderr but info messages go to stdout, and the event name was different. Additionally, the test was missing LOG_LEVEL=debug environment variable and had an incorrect stub that output error messages to stderr.",
  "resolution": "Fixed by: (1) Changed logging when type_present=0 from log_info to log_debug and from event name 'mdns_type_check' to 'mdns_type_check' (removing the duplicate event= in parameters). (2) Added LOG_LEVEL=debug to test environment. (3) Updated test stub to return empty output instead of error message for active query attempts. (4) Fixed test assertions to check $output instead of $stderr since BATS run command combines stdout and stderr. (5) Escaped quotes in regex pattern for available_types check.",
  "references": [
    "tests/bats/mdns_selfcheck.bats:460-502",
    "scripts/mdns_type_check.sh:117-147",
    "scripts/mdns_type_check.sh:292-315"
  ]
}
