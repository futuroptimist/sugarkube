{
  "id": "2025-11-05-mdns-selfcheck-test-18-dbus-backend",
  "date": "2025-11-05",
  "component": "tests/bats/mdns_selfcheck.bats:976",
  "rootCause": "Test 18 'mdns self-check succeeds via dbus backend' failed because: (1) The service type check in mdns_type_check.sh would fail-fast with exit code 4 when service type was not found via enumeration, preventing the dbus backend from ever being attempted. DBUS mode can browse services directly without requiring service type enumeration. (2) The test was missing systemctl and busctl stubs needed by wait_for_avahi_dbus.sh to check if Avahi daemon is ready.",
  "resolution": "Fixed by: (1) Modified mdns_type_check.sh line 318 to skip the fail-fast exit when SUGARKUBE_MDNS_DBUS=1 is set, allowing the script to proceed to the dbus backend path. (2) Added systemctl and busctl stubs to test 18 following the pattern from test 15, allowing wait_for_avahi_dbus.sh to succeed in the test environment.",
  "references": [
    "tests/bats/mdns_selfcheck.bats:976-1048",
    "scripts/mdns_type_check.sh:315-342",
    "scripts/mdns_selfcheck.sh:499-508",
    "scripts/wait_for_avahi_dbus.sh:146-220"
  ]
}
