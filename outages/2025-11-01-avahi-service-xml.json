{
  "id": "2025-11-01-avahi-service-xml",
  "date": "2025-11-01",
  "component": "scripts/k3s-discover.sh",
  "rootCause": "The Avahi XML renderer still emitted the legacy host@format name and dropped custom TXT records like state=*, so the workflow and API publish tests no longer matched the service contract.",
  "resolution": "Reworked render_avahi_service_xml to produce the documented \"k3s API <cluster>/<env> [role] on %h\" label, honor state arguments, and forward extra TXT records, then aligned the expectations in the render and publish tests.",
  "references": [
    "scripts/k3s-discover.sh",
    "tests/scripts/test_k3s_discover_render_xml.py",
    "tests/test_avahi_service_file.py",
    "tests/test_publish_api_service.py"
  ]
}
