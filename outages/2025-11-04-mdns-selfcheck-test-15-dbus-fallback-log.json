{
  "id": "2025-11-04-mdns-selfcheck-test-15-dbus-fallback-log",
  "date": "2025-11-04",
  "component": "tests/bats/mdns_selfcheck.bats:664",
  "rootCause": "Test 'mdns self-check falls back to CLI when dbus browser creation fails' expects 'fallback=cli' in output when SUGARKUBE_MDNS_DBUS=1 but gdbus ServiceBrowserNew call fails. Test stubs gdbus to exit 1 for ServiceBrowserNew, and stubs avahi-browse to succeed via CLI. The script should log that it's falling back from dbus to CLI mode.",
  "resolution": "Investigation needed in dbus fallback logic. The mdns_cli_dbus_fallback function (likely in mdns_selfcheck.sh around line 500-510) should detect browser creation failure and switch to CLI mode, logging 'fallback=cli' event. The fallback appears to work (test succeeds via CLI) but the logging may be missing or conditional.",
  "references": [
    "tests/bats/mdns_selfcheck.bats:664-720",
    "scripts/mdns_selfcheck.sh:500-510",
    "notes/final-summary.md:61-64"
  ]
}
