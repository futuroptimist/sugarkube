{
  "id": "2025-11-06-python314-mdns-query-import-path",
  "date": "2025-11-06",
  "component": "scripts/k3s-discover.sh:2021-2063",
  "rootCause": "Python 3.13+ changed behavior where scripts read from stdin (python3 -) no longer automatically include the current directory in sys.path (PEP 722 security improvement). The inline Python script in run_avahi_query() tried to compensate by manually adding SCRIPT_DIR to sys.path, but this approach was fragile. In Python 3.14, the manual sys.path manipulation was insufficient, causing import failures for k3s_mdns_query module. Tests in test_mdns_discovery_parsing.py failed with empty results because the imports failed silently, returning no mDNS query results.",
  "resolution": "Changed to use PYTHONPATH environment variable instead of runtime sys.path manipulation. Set PYTHONPATH=\"${SCRIPT_DIR}:${PYTHONPATH:-}\" before calling python3, which is the recommended approach for ensuring module import paths are available to Python scripts. This is more reliable across Python versions and follows Python best practices for module path management.",
  "references": [
    "tests/test_mdns_discovery_parsing.py:108-136",
    "scripts/k3s-discover.sh:2021-2063",
    "https://peps.python.org/pep-0722/"
  ]
}
