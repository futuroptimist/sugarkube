{
  "id": "2025-11-29-cloudflare-tunnel-token-mode",
  "date": "2025-11-29",
  "component": "cloudflare-tunnel dev env token-only mode",
  "rootCause": "Attempted to run Cloudflare Tunnel in remote-managed token mode on the Pi k3s cluster, but the deployment still behaved like a locally-managed tunnel looking for cert.pem/credentials.json. cloudflared logged origin-certificate errors because the connector token path and deployment command still aligned with the legacy origin-cert workflow instead of the TUNNEL_TOKEN-based remote-managed flow.",
  "resolution": "Aligned the deployment with Cloudflare's Kubernetes remote-managed guidance: inject TUNNEL_TOKEN from the tunnel-token Secret, run `cloudflared tunnel --no-autoupdate --metrics 0.0.0.0:2000 run` without any config or credentials mounts, upgrade the cloudflared image, and add stronger debug messaging/tests to flag origin-cert fallbacks earlier.",
  "references": [
    "https://github.com/futuroptimist/sugarkube/commit/586af22a6fde8418b14c7ef1b4e6e6f7815fd0db",
    "https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/tunnel-guide/remote/",
    "https://developers.cloudflare.com/cloudflare-one/connections/connect-apps/install-and-setup/tunnel-guide/kubernetes/",
    "https://github.com/cloudflare/cloudflared/issues/645"
  ]
}
