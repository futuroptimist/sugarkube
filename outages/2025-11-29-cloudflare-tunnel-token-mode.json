{
  "id": "2025-11-29-cloudflare-tunnel-token-mode",
  "date": "2025-11-29",
  "component": "cloudflare-tunnel dev env token-only mode",
  "rootCause": "Attempted to run cloudflared in remote-managed token-only mode on the Pi k3s cluster, but the Deployment still behaved like a locally-managed tunnel requiring cert.pem/credentials.json. Pods crashed with origin certificate path errors because cloudflared did not receive a valid remote-managed connector token or the tunnel itself was configured as locally managed.",
  "resolution": "Aligned the Deployment with Cloudflare's remote-managed Kubernetes example by sourcing TUNNEL_TOKEN from a Secret, running `cloudflared tunnel --no-autoupdate --metrics 0.0.0.0:2000 run`, removing any credentials/config mounts, and pinning a cloudflared image that supports token mode. Added clearer debug messaging and tests to flag origin-cert fallbacks early.",
  "references": [
    "https://github.com/futuroptimist/sugarkube/commit/<commit-hash>",
    "https://developers.cloudflare.com/cloudflare-one/networks/connectors/cloudflare-tunnel/get-started/create-remote-tunnel/",
    "https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/install-and-setup/tunnel-guide/kubernetes/",
    "https://github.com/cloudflare/cloudflared/issues/698"
  ]
}
