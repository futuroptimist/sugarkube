{
  "id": "mdns-test-incorrect-assertion",
  "date": "2025-11-04",
  "component": "tests/bats/mdns_selfcheck.bats",
  "rootCause": "The test 'mdns self-check confirms via CLI-only resolution' had an assertion checking that avahi-resolve was not invoked. However, avahi-resolve is legitimately called during the mdns_liveness_probe phase for self-resolution (via self_resolve_attempt -> resolve_self_ipv4 -> avahi-resolve). The test assertion was overly restrictive and didn't account for this expected behavior.",
  "resolution": "Removed the incorrect assertion '[ ! -f \"${BATS_TEST_TMPDIR}/avahi-resolve-invoked\" ]' from line 156. The test correctly validates that CLI resolution is used for the main resolution by checking resolve_method=cli, which is the actual intent. The fact that avahi-resolve is also called for self-resolution during liveness checks is expected and not a bug.",
  "references": [
    "https://github.com/futuroptimist/sugarkube/pull/1672",
    "https://github.com/futuroptimist/sugarkube/pull/1669",
    "https://github.com/futuroptimist/sugarkube/pull/1671",
    "scripts/mdns_selfcheck.sh#L301",
    "scripts/mdns_resolution.sh#L106"
  ]
}
