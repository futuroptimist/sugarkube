{
  "id": "k3s-discover-token-resolution",
  "date": "2025-10-31",
  "component": "scripts/k3s-discover.sh",
  "rootCause": "Pytest's token resolution checks invoked k3s-discover.sh which sourced scripts/lib/summary.sh. A missing closing quote in summary::step triggered a syntax error, and the summary emitter wrote to stdout, hiding the resolved token. After repairing those issues, the script still skipped fallback node/boot token files, leaving TOKEN empty.",
  "resolution": "Fixed the summary helper quoting, redirected summary output to stderr, taught k3s-discover.sh to load node and boot tokens, and renamed the overlapping CLI test module so pytest could import it without conflicts.",
  "references": [
    "tests/test_k3s_discover_token_resolution_cli.py",
    "tests/scripts/test_k3s_discover_token_resolution.py",
    "scripts/lib/summary.sh",
    "scripts/k3s-discover.sh"
  ]
}
