{
  "id": "2025-11-06-summary-bats-missing-setup",
  "date": "2025-11-06",
  "component": "tests/bats/summary.bats",
  "rootCause": "The summary.bats test file was missing a setup() function to initialize BATS_CWD variable. Tests 40 and 41 used ${BATS_CWD}/scripts/lib/summary.sh to source the summary library, but when BATS_CWD was unset, the path resolved to /scripts/lib/summary.sh (absolute path from root), which doesn't exist. This caused the source command to fail silently and the tests to fail with exit status != 0.",
  "resolution": "Added setup() function to summary.bats that sets BATS_CWD to the repository root by calculating it from BATS_TEST_DIRNAME (which BATS provides automatically). The setup function uses: BATS_CWD=\"$(cd \"${BATS_TEST_DIRNAME}/../..\" && pwd)\" to navigate from tests/bats/ up to the repository root, following the pattern used in other test files.",
  "references": [
    "tests/bats/summary.bats:3-6",
    "tests/bats/mdns_selfcheck.bats:5-6",
    ".github/workflows/ci.yml"
  ]
}
