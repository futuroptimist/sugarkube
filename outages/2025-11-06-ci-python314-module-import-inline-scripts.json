{
  "id": "ci-python314-module-import-inline-scripts",
  "date": "2025-11-06",
  "component": "k3s Discovery - mDNS Query",
  "rootCause": "Python 3.14 changed how module imports work when using 'python3 -' with stdin scripts. The k3s-discover.sh script uses 'env' command to set specific environment variables when running inline Python code, which starts with a clean environment and loses PYTHONPATH. The inline Python code imports modules from the scripts directory (k3s_mdns_query, k3s_mdns_parser, mdns_helpers), causing import failures and empty results in mDNS discovery tests on Python 3.14.",
  "resolution": "Modified inline Python scripts in k3s-discover.sh to: 1) Explicitly preserve PYTHONPATH when using 'env' command by adding it to the environment variable array, and 2) Add SCRIPT_DIR to sys.path programmatically before imports as a fallback. This dual approach ensures Python 3.14+ compatibility by both preserving the existing PYTHONPATH and providing explicit module search paths.",
  "references": [
    "scripts/k3s-discover.sh",
    "tests/test_mdns_discovery_parsing.py",
    "scripts/k3s_mdns_query.py"
  ]
}
