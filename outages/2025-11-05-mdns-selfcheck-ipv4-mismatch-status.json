{
  "id": "2025-11-05-mdns-selfcheck-ipv4-mismatch-status",
  "date": "2025-11-05",
  "component": "scripts/mdns_selfcheck.sh:593",
  "rootCause": "When resolve_host() detected an IPv4 mismatch and returned exit code 2, the calling code used '|| true' to prevent script termination due to 'set -e', but this caused the captured status variable to always be 0 instead of the actual return code. As a result, IPv4 mismatches were not detected, and the script failed with reason=resolve_failed (exit 1) instead of reason=ipv4_mismatch (exit 5).",
  "resolution": "Replaced the '|| true' pattern with 'set +e' / 'set -e' guards around the resolve_host call to properly capture the return code in the status variable. Now IPv4 mismatches correctly trigger exit code 5 with reason=ipv4_mismatch, enabling callers to distinguish IP changes (which may be transient during DHCP) from permanent failures and retry with relaxed IP matching.",
  "references": [
    "tests/bats/mdns_selfcheck.bats:548-590",
    "scripts/mdns_selfcheck.sh:585-595",
    "scripts/mdns_resolution.sh:47-92"
  ]
}
