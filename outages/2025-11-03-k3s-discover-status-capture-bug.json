{
  "id": "2025-11-03-k3s-discover-status-capture-bug",
  "date": "2025-11-03",
  "component": "scripts/k3s-discover.sh",
  "rootCause": "run_configure_avahi() function was capturing exit status ($?) after the if statement had already evaluated, which always yields 0, causing actual command failures to be incorrectly logged with status=0",
  "resolution": "Refactored to capture exit status immediately using '|| status=$?' pattern before the if statement completes, ensuring accurate error reporting",
  "references": [
    "scripts/k3s-discover.sh",
    "tests/scripts/test_k3s_discover_flag_parity.py::test_join_aborts_when_flag_parity_fails",
    "tests/scripts/test_k3s_discover_mid_election_join.py::test_join_when_server_advertises_during_election"
  ]
}
