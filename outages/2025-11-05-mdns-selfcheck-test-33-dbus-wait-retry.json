{
  "id": "2025-11-05-mdns-selfcheck-test-33-dbus-wait-retry",
  "date": "2025-11-05",
  "component": "tests/bats/mdns_selfcheck.bats:748",
  "rootCause": "Test 33 'mdns dbus self-check waits for avahi bus before browsing' was skipped because the script lacked retry logic for gdbus introspect calls when Avahi dbus service returns ServiceUnknown errors during startup. The test stub simulates Avahi starting up by failing with ServiceUnknown for the first 2 introspect calls, then succeeding on the 3rd. Without retry logic, the script would fail immediately instead of waiting for the service to become ready.",
  "resolution": "Added wait_for_avahi_dbus_gdbus() function in scripts/mdns_selfcheck_dbus.sh that retries gdbus introspect calls up to 10 times when ServiceUnknown errors are detected. The function sleeps 0.5 seconds between retries and logs the retry attempts. Returns 0 on success, 1 on timeout, and 2 if introspect is not supported (allowing graceful degradation for test environments that only stub gdbus call methods). Removed the skip directive from the test, enabling it to run and verify the retry behavior.",
  "references": [
    "tests/bats/mdns_selfcheck.bats:748-861",
    "scripts/mdns_selfcheck_dbus.sh:278-337",
    "notes/ci-test-fixes-action-plan.md#test-16"
  ]
}
