{
  "id": "2025-11-07-python314-mdns-query-sys-path-fix",
  "date": "2025-11-07",
  "component": "scripts/k3s-discover.sh:2029-2039",
  "rootCause": "Python 3.14.0 further tightened import path handling for stdin scripts (python3 -). While the previous fix set PYTHONPATH environment variable, Python 3.14 still failed to import k3s_mdns_query module from stdin scripts. The three failing tests (test_server_first_returns_expected_host, test_server_count_detects_all_servers, test_print_server_hosts_lists_unique_hosts) all returned empty results because the inline Python script's import failed silently, causing query_mdns() to never execute. This is an extension of the Python 3.13+ change where stdin scripts lost automatic current directory in sys.path - Python 3.14 appears to require explicit sys.path manipulation even when PYTHONPATH is set.",
  "resolution": "Added explicit sys.path.insert(0, scripts_dir) in the inline Python script before the import statement. The scripts directory is now passed as a 4th argument to the inline script and prepended to sys.path before any imports occur. This ensures k3s_mdns_query and its dependencies (mdns_helpers, k3s_mdns_parser) can be imported in both Python 3.12-3.14+. The PYTHONPATH environment variable is still set for backwards compatibility with other tools.",
  "references": [
    "tests/test_mdns_discovery_parsing.py:108-136",
    "scripts/k3s-discover.sh:2021-2063",
    "outages/2025-11-06-python314-mdns-query-import-path.json",
    "https://docs.python.org/3/whatsnew/3.14.html"
  ]
}
