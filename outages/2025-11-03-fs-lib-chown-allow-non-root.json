{
  "id": "2025-11-03-fs-lib-chown-allow-non-root",
  "date": "2025-11-03",
  "component": "scripts/lib/fs.sh",
  "rootCause": "fs::apply_metadata function was attempting to chown files to root:root even when ALLOW_NON_ROOT=1, causing permission errors in tests",
  "resolution": "Modified fs::apply_metadata to skip chown when ALLOW_NON_ROOT=1 and running as non-root user, allowing tests to run without sudo",
  "references": [
    "scripts/lib/fs.sh",
    "tests/scripts/test_k3s_discover_bootstrap_publish.py::test_bootstrap_publish_writes_static_service",
    "tests/scripts/test_k3s_discover_bootstrap_publish.py::test_bootstrap_publish_sanitizes_trailing_dot_hostname"
  ]
}
