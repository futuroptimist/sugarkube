{
  "id": "mdns-test-missing-curl-stub",
  "date": "2025-11-04",
  "component": "tests/bats/mdns_selfcheck.bats",
  "rootCause": "The server_socket_ready() function in scripts/mdns_selfcheck.sh performs socket readiness checks when validating server nodes, trying curl, python, and devtcp probes in order. In test environments without a stubbed curl command, these probes failed because no actual k3s API server is listening on port 6443, causing tests to fail with 'server_socket_unready' errors.",
  "resolution": "Added curl stub to server role tests to simulate successful API readiness. Pattern used: stub_command curl <<'EOS' followed by #!/usr/bin/env bash and exit 0. Applied to 10+ server role tests in tests/bats/mdns_selfcheck.bats.",
  "references": [
    "https://github.com/futuroptimist/sugarkube/pull/1672",
    "https://github.com/futuroptimist/sugarkube/pull/1669",
    "https://github.com/futuroptimist/sugarkube/pull/1671",
    "scripts/mdns_selfcheck.sh#L425",
    "scripts/mdns_selfcheck.sh#L443"
  ]
}
