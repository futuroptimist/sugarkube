{
  "id": "2025-11-05-mdns-selfcheck-bootstrap-filter-reason",
  "date": "2025-11-05",
  "component": "scripts/mdns_selfcheck.sh:742-748",
  "rootCause": "When avahi-browse found service instances but none matched the required role filter (e.g., found role=bootstrap when EXPECTED_ROLE=server), parse_browse() correctly filtered them out and returned empty. However, the failure reason logic prioritized self_resolve_attempt errors over the browse-level instance_not_found reason. This caused the script to report reason=resolve_failed instead of reason=instance_not_found, making it harder to diagnose role mismatch issues.",
  "resolution": "Added explicit check in the failure reason priority logic to preserve browse_reason=instance_not_found when browse output exists but no instances match the role/phase filters. This ensures role filtering failures are clearly reported as instance_not_found rather than being masked by subsequent resolution attempt failures.",
  "references": [
    "tests/bats/mdns_selfcheck.bats:592-623",
    "tests/fixtures/avahi_browse_bootstrap_only.txt",
    "scripts/mdns_selfcheck.sh:686-750",
    "scripts/mdns_helpers.sh:227-228"
  ]
}
