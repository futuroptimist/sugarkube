#!/usr/bin/env bash
set -euo pipefail
if [[ "$*" == "-a -t -r" ]]; then
  cat <<'OUT'
+;eth0;IPv4;allowed.local;_http._tcp;local
=;eth0;IPv4;allowed.local;_http._tcp;local;allowed.local;192.0.2.23;80;txt=role=public
=;eth0;IPv4;k3s-sugar-dev@sugarkube0.local (server);_k3s-sugar-dev._tcp;local;sugarkube0.local;10.0.0.5;6443;txt=cluster=sugar;txt=env=dev;txt=role=server
=;eth0;IPv4;secret-host.local;_http._tcp;local;secret-host.local;198.51.100.4;80;txt=internal=true
OUT
  exit 0
fi

if [[ "$1" == "-t" && "$2" == "-r" && "$3" == "_k3s-sugar-dev._tcp" ]]; then
  cat <<'OUT'
=;eth0;IPv4;k3s-sugar-dev@sugarkube0.local (server);_k3s-sugar-dev._tcp;local;sugarkube0.local;10.0.0.5;6443;txt=cluster=sugar;txt=env=dev;txt=role=server
=;eth0;IPv4;k3s-sugar-dev@sugarkube1.local (server);_k3s-sugar-dev._tcp;local;sugarkube1.local;203.0.113.7;6443;txt=cluster=sugar;txt=env=dev;txt=role=server
OUT
  exit 0
fi

echo "avahi-browse stub unexpected: $*" >&2
exit 1
