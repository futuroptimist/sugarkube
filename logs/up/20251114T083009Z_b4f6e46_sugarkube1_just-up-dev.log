# Sugarkube debug log (sanitized)
# Source: just up dev
# Generated: 2025-11-14T08:30:09Z
# Secrets and external IP addresses have been redacted.
[sugarkube] All apt packages already installed.
[sugarkube] avahi-daemon service already active.
[sugarkube] mDNS resolver already configured in /etc/nsswitch.conf.
[sugarkube] Memory cgroup controller detected.
ensure_unique_hostname hostname is already unique hostname=sugarkube1
[sugarkube] Memory cgroup controller is active; nothing to do.
ts=2025-11-14T00:30:15-08:00 level=info event=discover event=token_resolution token_present=1 allow_bootstrap=0 node_token_state=missing boot_token_state=missing token_source="/home/pi/sugarkube/scripts/resolve_server_token.sh"
ts=2025-11-14T00:30:15-08:00 level=info event=discover event=configure_avahi outcome=ok script=/home/pi/sugarkube/scripts/configure_avahi.sh
ts=2025-11-14T00:30:15-08:00 level=info event=iptables_preflight msg="iptables binary is missing" severity=warn outcome=warn details="variant=missing,version=unavailable,nft=yes,kube-proxy=iptables,kube-proxy-source=default" variant=missing version=unavailable nft_available=yes kube_proxy_mode="iptables" kube_proxy_source="default" kube_proxy_nft_configured=0 remediation="install_iptables_package"
ts=2025-11-14T00:30:15-08:00 level=info event=discover event=mdns_absence_gate phase=start host=sugarkube1.local service=_k3s-sugar-dev._tcp timeout_ms=15000
ts=2025-11-14T00:30:15-08:00 level=info event=discover event=mdns_absence_gate action=restart_avahi outcome=ok
ts=2025-11-14T00:30:15-08:00 level=info event=discover event=mdns_absence_gate action=restart_stabilization delay_ms=2000
ts=2025-11-14T00:30:17-08:00 level=info event=avahi_dbus_call outcome=retry ms_elapsed=67 bus_status=call_failed bus_owner=unknown bus_code=0 bus_destination=org.freedesktop.Avahi bus_object=/org/freedesktop/Avahi/Server bus_interface=org.freedesktop.Avahi.Server bus_method=GetVersionString bus_error=Call_failed:_Method_GetVersionString_with_signature__on_interface_org.freedesktop.Avahi.Server_doesnt_exist
ts=2025-11-14T00:30:37-08:00 level=info event=avahi_dbus_ready outcome=timeout ms_elapsed=20092 systemd_state=active systemd_status=0 bus_status=call_failed bus_code=0 bus_error=Call_failed:_Method_GetVersionString_with_signature__on_interface_org.freedesktop.Avahi.Server_doesnt_exist bus_destination=org.freedesktop.Avahi bus_object=/org/freedesktop/Avahi/Server bus_interface=org.freedesktop.Avahi.Server bus_method=GetVersionString bus_owner=unknown
ts=2025-11-14T00:30:38-08:00 level=info event=discover msg="mDNS absence gate timed out" severity=warn mdns_absence_confirmed=0 attempts=1 ms_elapsed=23331 reason=timeout last_method=cli consecutive_dbus_absent=0 wire_proof_status=skipped
ts=2025-11-14T00:30:38-08:00 level=info event=discover phase=discover_existing cluster=sugar environment=dev
ts=2025-11-14T00:30:40-08:00 level=info event=discover event=discovery_failopen_tracking_started timeout_secs=300
ts=2025-11-14T00:30:40-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:30:47-08:00 level=info event=discover event=mdns_diag_start failure_count=2 threshold=2
=== mDNS Diagnostic Output ===
=== mDNS Diagnostic ===
Hostname: sugarkube1.local
Service:  _k3s-sugar-dev._tcp

▶ Checking D-Bus service...
  ✓ dbus is active
▶ Checking Avahi daemon...
  ✓ avahi-daemon is active
▶ Browsing for _k3s-sugar-dev._tcp services...
  ✗ avahi-browse failed (exit code: 1) after 2 attempts
▶ Resolving sugarkube1.local...
  ✓ Resolved to 192.168.86.45
▶ Checking NSS mDNS resolution...
  ✓ NSS resolved to 192.168.86.45
▶ Checking Avahi configuration...
  ✓ Avahi configuration looks OK

=== Summary ===

Failures (1):
  ✗ avahi-browse command failed after 2 retries (daemon may be restarting)

=== Suggested Remediation ===
• Check Avahi daemon logs:
    journalctl -u avahi-daemon -n 50
• Restart Avahi daemon:
    sudo systemctl restart avahi-daemon

For more information, see:
  • Avahi documentation: https://avahi.org/
  • Sugarkube docs: docs/pi-cluster-bootstrap.md
=============================
ts=2025-11-14T00:30:48-08:00 level=info event=discover event=mdns_diag_complete status=1 failure_count=2
ts=2025-11-14T00:31:43-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:31:43-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:32:44-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:32:44-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:33:45-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:33:45-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:34:46-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:34:46-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:35:41-08:00 level=info event=discover msg="mDNS discovery failed for 301s; switching to fail-open direct join" elapsed_secs=301 timeout_secs=300
ts=2025-11-14T00:37:42-08:00 level=info event=apiready outcome=timeout host="sugarkube0.local" port="6443" attempts=60 elapsed=120 last_status=401:0 reason=http_error ip="192.168.86.41"
ts=2025-11-14T00:37:42-08:00 level=info event=discover msg="API readiness gate failed" severity=error script=/home/pi/sugarkube/scripts/check_apiready.sh host=sugarkube0.local ip=192.168.86.41 port=6443 phase=api_ready
ts=2025-11-14T00:37:42-08:00 level=info event=discover event=failopen_join attempt=1 server="sugarkube0.local" outcome=error reason=api_unreachable
ts=2025-11-14T00:39:43-08:00 level=info event=apiready outcome=timeout host="sugarkube1.local" port="6443" attempts=61 elapsed=121 last_status=000:7 reason=curl_failed ip="192.168.86.45"
ts=2025-11-14T00:39:43-08:00 level=info event=discover msg="API readiness gate failed" severity=error script=/home/pi/sugarkube/scripts/check_apiready.sh host=sugarkube1.local ip=192.168.86.45 port=6443 phase=api_ready
ts=2025-11-14T00:39:43-08:00 level=info event=discover event=failopen_join attempt=2 server="sugarkube1.local" outcome=error reason=api_unreachable
ts=2025-11-14T00:41:45-08:00 level=info event=apiready outcome=timeout host="sugarkube2.local" port="6443" attempts=61 elapsed=121 last_status=000:7 reason=curl_failed ip="192.168.86.50"
ts=2025-11-14T00:41:45-08:00 level=info event=discover msg="API readiness gate failed" severity=error script=/home/pi/sugarkube/scripts/check_apiready.sh host=sugarkube2.local ip=192.168.86.50 port=6443 phase=api_ready
ts=2025-11-14T00:41:45-08:00 level=info event=discover event=failopen_join attempt=3 server="sugarkube2.local" outcome=error reason=api_unreachable
ts=2025-11-14T00:41:45-08:00 level=info event=discover msg="All fail-open candidates failed; returning to normal discovery" severity=warn
ts=2025-11-14T00:41:45-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:41:45-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:42:46-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:42:47-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:43:48-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:43:48-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:44:49-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:44:49-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:45:50-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:45:50-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:46:51-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:46:51-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
ts=2025-11-14T00:47:53-08:00 level=info event=discover event=follower_election_retry wait_secs=60
ts=2025-11-14T00:47:53-08:00 level=info event=discover event=election outcome=follower key=sugarkube1
