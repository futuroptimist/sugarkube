# Example configuration for the first k3s server node in an HA control plane.
# Apply to /etc/rancher/k3s/config.yaml before starting k3s.
# Provide the shared bootstrap token via a file mounted at this path.
token-file: /etc/rancher/k3s/token
write-kubeconfig-mode: "0644"
tls-san:
  - api.dev.sugarkube.internal
  - api.int.sugarkube.internal
  - api.prod.sugarkube.internal
  - 10.10.0.40  # dev VIP
  - 10.20.0.40  # int VIP
  - 10.30.0.40  # prod VIP
cluster-init: true
disable:
  - servicelb
  # keep traefik enabled by default
node-taint:
  - "CriticalAddonsOnly=true:NoExecute"
  - "node-role.kubernetes.io/control-plane=true:NoSchedule"
node-label:
  - "node-role.kubernetes.io/control-plane=true"
write-kubeconfig: /etc/rancher/k3s/k3s.yaml
kube-controller-manager-arg:
  - "terminated-pod-gc-threshold=10"
protect-kernel-defaults: true
etcd-snapshot-schedule-cron: "0 */12 * * *"
etcd-snapshot-retention: 5
etcd-snapshot-dir: /var/lib/rancher/k3s/server/db/snapshots
# Enable these when ready to offload snapshots to S3. Secrets provided by SOPS.
# etcd-s3: true
# etcd-s3-endpoint: ${ETCD_S3_ENDPOINT}
# etcd-s3-bucket: ${ETCD_S3_BUCKET}
# etcd-s3-region: ${ETCD_S3_REGION}
# etcd-s3-access-key: ${ETCD_S3_ACCESS_KEY}
# etcd-s3-secret-key: ${ETCD_S3_SECRET_KEY}
