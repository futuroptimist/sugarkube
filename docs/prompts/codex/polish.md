### Sugarkube — Polish Plan

This doc contains two runnable prompts for OpenAI Codex.

---

## Section 1 — **Polish Prompt (one‑click, evergreen)**

~~~md
# Sugarkube — Polish Prompt (One‑Click, Evergreen)

You are operating on the repository: **futuroptimist/sugarkube**.

**Mission**
Perform a holistic polish pass that improves structure, clarity, maintainability, and contributor experience **without changing runtime behavior**. Treat this as a phase-2 refinement used after `implement.md` starts to saturate (low orthogonality among variants). The work must be **idempotent** and result in a **single small PR**.

**Repository realities to respect (hardware + software)**
- Mixed domains: CAD (`cad/`), electronics (`elex/` incl. `power_ring`), hardware accessories (`hardware/`), prebuilt artifacts (`stl/`), scripts (`scripts/`), tests (`tests/`), outages logs (`outages/`), samples/fixtures (`samples/`), and the Kubernetes helper layer (`sugarkube_toolkit/`).
- Rich docs set under `docs/` (e.g., `start-here.md`, network setup, solar/electronics basics, power system design, image/provisioning/field guides).
- CI/tooling already present: pre-commit, spellcheck, coverage, `Makefile`/`Taskfile.yml`/`justfile`, `pyproject.toml`, KiCad automation via `.kibot/`, and `llms.txt` for LLM adapters.

**Constraints**
- Keep public interfaces, docs entry points, and CI green.
- Prefer **moves/renames** and documentation over rewrites.
- Avoid ephemeral content (timestamps/SHAs); normalize generated content ordering to avoid churn.
- If uncertain, propose the change in the PR description rather than forcing it.

**Deliverables (in a single PR on branch `chore/polish-docs-and-structure`)**

1) **Repo Snapshot (autogenerated in the PR description)**
   - Enumerate: languages, key directories, presence of `.kibot/`, `Makefile`/`Taskfile.yml`/`justfile`, test/coverage posture, and current prompt docs.
   - Link the top-5 newcomer docs (e.g., `docs/start-here.md`, image/provisioning guides, field guide).

2) **Prompt-docs standardization**
   - Ensure `docs/prompts/codex/` exists.
   - Move any existing prompt docs there; **rename** to drop `prompt(s)`/`codex` from filenames since those are implied by the path.
   - Keep canonical names where applicable: `automation.md`, `implement.md`, `polish.md`, `agents.md`, `playbook.md`.
   - Update internal links (README, docs) accordingly.
   - Add an idempotent script: `scripts/migrate-prompt-docs.sh` to perform these moves/renames safely (no-op if repeated). Document usage in `docs/README.md`.

3) **Documentation & navigation polish (clarify the two “Sugarkube” meanings)**
   - Create/refresh a **single entry index** (`docs/start-here.md` remains canonical) linking:
     - **15-minute quick path**, **day-one build**, **advanced references**.
     - Distinct **Hardware** vs **Toolkit** tracks so readers don’t mix the solar cube build with the Kubernetes layer.
   - Add/refresh a “**Map of the repo**” section in `README` that points to setup → run → test in ≤3 clicks.

4) **Directory hygiene (minimal, non-breaking)**
   - Keep existing names but clarify intent with short `README.md` files in:
     - `cad/` (OpenSCAD sources and regeneration notes),
     - `elex/` (KiCad/Fritzing + DRC/ERC expectations),
     - `sugarkube_toolkit/` (Kubernetes helper layer: scripts/manifests/Helm/Flux if present),
     - `stl/` (generated artifacts, checksums).
   - If cluster manifests exist outside `sugarkube_toolkit/`, consolidate a lightweight `infra/` with `base/` and per-env `overlays/` (GitOps-friendly). Keep it opt-in if not present to avoid churn.

5) **Safety, build & regeneration pipelines**
   - **Electronics (KiCad)**: ensure `.kibot/` DRC/ERC runs in CI; document how to invoke locally; publish concise build artifacts summary in PR checks.
   - **CAD/STL**: add/refresh `scripts/rebuild-stl.sh` to produce STLs deterministically; persist a checksum list under `stl/` and gate via CI to detect drift.
   - **Image & provisioning**: confirm `docs/pi_image_quickstart.md` + `docs/pi_headless_provisioning.md` flow; add `secrets.env.example` with comments and a clear **safety disclaimer** (battery handling, current limits, polarity).

6) **DX & Testing**
   - One-command local workflow (`make dev` / `just dev`), `make test`, `make spell`, `make links`.
   - Smoke tests for any scripts that fetch/build artifacts (dry-run flags).
   - Ensure coverage thresholds and docs link/spell checks run in CI.

7) **Orthogonality & saturation tracker**
   - Append a tiny rubric to `docs/` explaining when to pivot from `implement.md` to polish tasks (e.g., when variant PRs collide or delta per variant diminishes).
   - Include a checkbox log to record observed collisions and PR overlap.

**Files to stage**
- `docs/prompts/codex/polish.md` (this file; do not alter Section structure)
- `docs/README.md` (short “Prompt docs” index with links)
- `scripts/migrate-prompt-docs.sh` (idempotent; POSIX shell)
- Any prompt-doc moves/renames; minimal `README.md` breadcrumbs in key directories
- Optional: `README` “Map of the repo” and entry-index improvements

**PR details**
- Branch: `chore/polish-docs-and-structure`
- Title: `chore: polish docs + structure (idempotent)`
- Body:
  - Repo Snapshot (bullets)
  - What changed (moves/renames; no functional changes)
  - How to test locally (commands)
  - Idempotency notes

**Success criteria**
- CI stays green.
- Re-running this prompt causes **no diff** (idempotent).
- All prompt docs live under `docs/prompts/codex/` with canonical naming.
- README provides a clear entry map and links to prompts.

> Execute now. If any step is ambiguous, propose the minimal, reversible change and note it in the PR body.
~~~

---

## Section 2 — **Upgrade Prompt (to refine Section 1 over time)**

~~~md
# Sugarkube — Upgrade Prompt for Section 1

You are operating on the repository: **futuroptimist/sugarkube**.

**Goal**
Evolve the **Section 1 “Polish Prompt”** above to reflect new conventions, tools, or lessons learned—**without** breaking idempotency or expanding scope beyond polish.

**What to do**
1) **Read** the current Section 1 codeblock verbatim.
2) **Diagnose gaps**:
   - Are layout recommendations aligned with actual repo usage (hardware vs toolkit clarity)?
   - Do CI steps reflect current practice (pre-commit, spell/link checks, coverage, KiCad `.kibot/`, STL checksums)?
   - Are prompt-doc rename/move rules complete and conflict-free?
   - Are `start-here.md` and the README entry map concise and sufficient?
3) **Propose precise edits** to Section 1 language to:
   - Clarify actions that caused reviewer confusion.
   - Tighten idempotency (avoid churn; stable ordering; deterministic generation).
   - Keep the PR small and readable; avoid scope creep.
4) **Do not** expand into feature work; stay within structure/docs/tests polish.

**Output**
- A **redlined diff** (or exact replacement text) for the Section 1 codeblock.
- A short rationale list (bullets) summarizing why each change improves clarity or idempotency.

**Constraints**
- Preserve the one‑click nature and small PR footprint.
- Maintain repository interface and CI invariants.

> Produce the updated Section 1 content ready to paste back into this file, then summarize rationale.
~~~
